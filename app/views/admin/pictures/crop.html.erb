<% title "Crop Blog Thumbnail" %>
<% content_for(:head) do %>
	<script type="text/javascript" charset="utf-8">
	$(function() {
	  $('#cropbox').Jcrop({
	    onChange: update_crop,
	    onSelect: update_crop,
	    setSelect: [0, 0, <%= @picture.image_geometry(:medium).width.to_i %>, <%= @picture.image_geometry(:medium).height.to_i %>],
	    aspectRatio: <%= @picture.image_aspect_ratio %>
	  });
	});

	function update_crop(coords) {
	  var ratio = <%= @picture.image_geometry(:original).width %> / <%= @picture.image_geometry(:large).width %>;
	  $("#crop_x").val(Math.round(coords.x * ratio));
	  $("#crop_y").val(Math.round(coords.y * ratio));
	  $("#crop_w").val(Math.round(coords.w * ratio));
	  $("#crop_h").val(Math.round(coords.h * ratio));
	}
	</script>
<% end %>

<div class="row">
  <div class="span4">
	<h1><%= @title %></h1>
</div>		
  <div class="span3">
	<%= form_for [:admin, @picture] do |f| %>
	  <% for attribute in [:crop_x, :crop_y, :crop_w, :crop_h] %>
	    <%= f.hidden_field attribute, :id => attribute %>
	  <% end %>
<%= f.submit "Save Crop", :class => "btn btn-primary" %>
	<% end %>	
  </div>	
</div>	
<div class="row">
  <div class="span12">
<%= image_tag @picture.image.url(:large), :id => "cropbox" %>
</div>	
</div>	